<div class="invoice-wrapper">
  <!-- Loading Spinner -->
  <div class="loading-indicator" *ngIf="isLoading">
    <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
    <p>Loading invoice details...</p>
  </div>

  <!-- Error State -->
  <div class="error-state" *ngIf="errorMessage">
    <mat-icon class="error-icon">error</mat-icon>
    <p>{{ errorMessage }}</p>
    <button mat-raised-button color="primary" (click)="loadInvoiceDetails()">
      Retry
    </button>
    <button mat-button (click)="navigateBack()">
      Back to Invoice List
    </button>
  </div>

  <!-- Invoice Content -->
  <div *ngIf="!isLoading && !errorMessage && invoiceData" class="invoice-content">
    <!-- Screen Only Actions -->
    <div class="invoice-actions no-print">
      <button mat-button class="back-button" (click)="navigateBack()">
        <mat-icon>arrow_back</mat-icon>
        Back to List
      </button>
      <button mat-raised-button color="primary" (click)="printInvoice()">
        <mat-icon>print</mat-icon>
        Print Invoice
      </button>
    </div>

    <!-- Invoice Document - Fixed for printing -->
    <div class="invoice-document">
      <!-- Header Section -->
      <div class="invoice-header">
        <div class="company-section">
          <img ngSrc="/assets/images/netcarat-logo.png" alt="NetCarat Logo" class="company-logo" height="428"
               width="1868">
          <div class="company-details">
            <div>MozartStr. 38, 82140, Olching</div>
            <div>Phone: +49 176 10868668 | Email: info&#64;netcarat.eu</div>
          </div>
        </div>

        <div class="invoice-title-section">
          <h1 class="invoice-title">INVOICE</h1>
          <div class="invoice-meta">
            <div class="meta-row">
              <span class="meta-label">Invoice Number:</span>
              <span class="meta-value">{{ invoiceData.invoiceNumber }}</span>
            </div>
            <div class="meta-row">
              <span class="meta-label">Date:</span>
              <span class="meta-value">{{ invoiceData.invoiceDate }}</span>
            </div>
            <div class="meta-row">
              <span class="meta-label">Due Date:</span>
              <span class="meta-value">{{ invoiceData.dueDate }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Bill To Section -->
      <div class="bill-to-section">
        <div class="section-title">BILL TO:</div>
        <div class="bill-to-content">
          <div class="client-name">{{ invoiceData.client.name }}</div>
          <div class="client-info">{{ invoiceData.client.address }}</div>
          <div class="client-info" *ngIf="invoiceData.client.email">
            {{ invoiceData.client.email }}
          </div>
          <div class="client-info" *ngIf="invoiceData.client.phone">
            {{ invoiceData.client.phone }}
          </div>
        </div>
      </div>

      <!-- Items Table -->
      <div class="items-section">
        <table class="items-table">
          <thead>
          <tr class="table-header">
            <th class="col-id">Item ID</th>
            <th class="col-description">Description</th>
            <th class="col-type">Payment Type</th>
            <th class="col-amount">Amount</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let item of invoiceData.invoiceItems" class="table-row">
            <td class="col-id">{{ item.productId }}</td>
            <td class="col-description">{{ item.description || 'Product Item' }}</td>
            <td class="col-type">
                <span class="payment-badge" [class]="item.paymentType.toLowerCase()">
                  {{ item.paymentType }}
                </span>
            </td>
            <td class="col-amount">€{{ item.soldPrice.toFixed(2) }}</td>
          </tr>
          </tbody>
        </table>
      </div>

      <!-- Totals Section -->
      <div class="totals-section">
        <div class="totals-container">
          <div class="total-row subtotal-row">
            <span class="total-label">Subtotal:</span>
            <span class="total-value">€{{ invoiceData.subtotal.toFixed(2) }}</span>
          </div>
          <div class="total-row tax-row">
            <span class="total-label">Tax ({{ invoiceData.taxRate }}%):</span>
            <span class="total-value">€{{ invoiceData.taxAmount.toFixed(2) }}</span>
          </div>
          <div class="total-row grand-total-row">
            <span class="total-label">Total Amount:</span>
            <span class="total-value">€{{ invoiceData.totalAmount.toFixed(2) }}</span>
          </div>
        </div>
      </div>

      <!-- Footer Section -->
      <div class="invoice-footer">
        <div class="footer-left">
          <div class="footer-title">Payment Terms & Conditions:</div>
          <ul class="terms-list">
            <li>Payment is due within 30 days of invoice date</li>
            <li>Late payments may incur additional charges</li>
            <li>All items sold are subject to our standard terms</li>
            <li>For inquiries, please contact us</li>
          </ul>
        </div>
        <div class="footer-right">
          <div class="thank-you-text">Thank you for your business!</div>
          <div class="appreciation-text">We appreciate your trust in NetCarat for your luxury jewelry and timepiece needs.</div>
        </div>
      </div>
    </div>
  </div>
</div>
